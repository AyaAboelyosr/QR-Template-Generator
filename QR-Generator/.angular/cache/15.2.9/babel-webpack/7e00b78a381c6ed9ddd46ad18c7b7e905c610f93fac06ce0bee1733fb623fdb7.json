{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/app/qrtemplategenerator/services/template.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"angular-custom-modal\";\nimport * as i5 from \"../../../shared/icon/icon-layout-grid\";\nimport * as i6 from \"../../../shared/icon/icon-list-check\";\nimport * as i7 from \"../../../shared/icon/icon-search\";\nimport * as i8 from \"../../../shared/icon/icon-user-plus\";\nconst _c0 = [\"addSectionModal\"];\nconst _c1 = [\"addFieldModal\"];\nfunction TemplateDetailsComponent_ng_container_31_ng_container_12_tr_14_ng_container_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0, 35);\n    i0.ɵɵelementStart(1, \"tr\")(2, \"td\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\")(9, \"div\", 27)(10, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_ng_container_31_ng_container_12_tr_14_ng_container_15_Template_button_click_10_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const field_r12 = restoredCtx.$implicit;\n      const section_r9 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r13.editField(section_r9, field_r12));\n    });\n    i0.ɵɵtext(11, \"Edit Field\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 29);\n    i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_ng_container_31_ng_container_12_tr_14_ng_container_15_Template_button_click_12_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const field_r12 = restoredCtx.$implicit;\n      const section_r9 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r16 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r16.deleteField(section_r9, field_r12.id));\n    });\n    i0.ɵɵtext(13, \"Delete Field\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const field_r12 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(field_r12.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(field_r12.type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(field_r12.isRequired ? \"Yes\" : \"No\");\n  }\n}\nfunction TemplateDetailsComponent_ng_container_31_ng_container_12_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 31)(2, \"div\", 22)(3, \"table\", 23)(4, \"thead\")(5, \"tr\")(6, \"th\");\n    i0.ɵɵtext(7, \"Field Title\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Type\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Required\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\", 24);\n    i0.ɵɵtext(13, \"Actions\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"tbody\");\n    i0.ɵɵtemplate(15, TemplateDetailsComponent_ng_container_31_ng_container_12_tr_14_ng_container_15_Template, 14, 3, \"ng-container\", 32);\n    i0.ɵɵelementStart(16, \"tr\")(17, \"td\", 33)(18, \"button\", 34);\n    i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_ng_container_31_ng_container_12_tr_14_Template_button_click_18_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const section_r9 = i0.ɵɵnextContext().$implicit;\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r18.editField(section_r9));\n    });\n    i0.ɵɵtext(19, \"Add Field\");\n    i0.ɵɵelementEnd()()()()()()()();\n  }\n  if (rf & 2) {\n    const section_r9 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(15);\n    i0.ɵɵproperty(\"ngForOf\", section_r9.fields);\n  }\n}\nfunction TemplateDetailsComponent_ng_container_31_ng_container_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0, 26);\n    i0.ɵɵelementStart(1, \"tr\")(2, \"td\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\")(7, \"div\", 27)(8, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_ng_container_31_ng_container_12_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r23);\n      const section_r9 = restoredCtx.$implicit;\n      const ctx_r22 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r22.editSection(ctx_r22.template.id, section_r9));\n    });\n    i0.ɵɵtext(9, \"Edit Section\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 29);\n    i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_ng_container_31_ng_container_12_Template_button_click_10_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r23);\n      const section_r9 = restoredCtx.$implicit;\n      const ctx_r24 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r24.deleteSection(ctx_r24.template.id, section_r9.id));\n    });\n    i0.ɵɵtext(11, \"Delete Section\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 30);\n    i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_ng_container_31_ng_container_12_Template_button_click_12_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r23);\n      const section_r9 = restoredCtx.$implicit;\n      const ctx_r25 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r25.toggleFields(section_r9));\n    });\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(14, TemplateDetailsComponent_ng_container_31_ng_container_12_tr_14_Template, 20, 1, \"tr\", 15);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const section_r9 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(section_r9.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(section_r9.type);\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate1(\" \", section_r9.expanded ? \"Hide Fields\" : \"View Fields\", \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", section_r9.expanded && section_r9.fields);\n  }\n}\nfunction TemplateDetailsComponent_ng_container_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 22)(2, \"table\", 23)(3, \"thead\")(4, \"tr\")(5, \"th\");\n    i0.ɵɵtext(6, \"Section Title\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Type\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\", 24);\n    i0.ɵɵtext(10, \"Actions\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"tbody\");\n    i0.ɵɵtemplate(12, TemplateDetailsComponent_ng_container_31_ng_container_12_Template, 15, 4, \"ng-container\", 25);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.template.sections);\n  }\n}\nfunction TemplateDetailsComponent_ng_template_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 36);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r3.params.controls[\"id\"].value ? \"Edit Template\" : \"Add Template\");\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_div_5_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Title is required.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_div_5_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Title must be at least 3 characters long.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_div_5_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Title cannot be more than 100 characters long.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 47);\n    i0.ɵɵtemplate(1, TemplateDetailsComponent_ng_template_36_div_5_div_1_Template, 2, 0, \"div\", 15);\n    i0.ɵɵtemplate(2, TemplateDetailsComponent_ng_template_36_div_5_div_2_Template, 2, 0, \"div\", 15);\n    i0.ɵɵtemplate(3, TemplateDetailsComponent_ng_template_36_div_5_div_3_Template, 2, 0, \"div\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r26 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r26.params.controls[\"title\"].errors == null ? null : ctx_r26.params.controls[\"title\"].errors[\"required\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r26.params.controls[\"title\"].errors == null ? null : ctx_r26.params.controls[\"title\"].errors[\"minlength\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r26.params.controls[\"title\"].errors == null ? null : ctx_r26.params.controls[\"title\"].errors[\"maxlength\"]);\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_div_10_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Unique Code is required.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_div_10_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Unique Code must follow the pattern SI-XXX.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 47);\n    i0.ɵɵtemplate(1, TemplateDetailsComponent_ng_template_36_div_10_div_1_Template, 2, 0, \"div\", 15);\n    i0.ɵɵtemplate(2, TemplateDetailsComponent_ng_template_36_div_10_div_2_Template, 2, 0, \"div\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r27 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r27.params.controls[\"uniqeCode\"].errors == null ? null : ctx_r27.params.controls[\"uniqeCode\"].errors[\"required\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r27.params.controls[\"uniqeCode\"].errors == null ? null : ctx_r27.params.controls[\"uniqeCode\"].errors[\"pattern\"]);\n  }\n}\nfunction TemplateDetailsComponent_ng_template_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r34 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"form\", 37);\n    i0.ɵɵlistener(\"ngSubmit\", function TemplateDetailsComponent_ng_template_36_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r34);\n      const ctx_r33 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r33.saveTemplate());\n    });\n    i0.ɵɵelementStart(1, \"div\", 38)(2, \"label\", 39);\n    i0.ɵɵtext(3, \"Title\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"input\", 40);\n    i0.ɵɵtemplate(5, TemplateDetailsComponent_ng_template_36_div_5_Template, 4, 3, \"div\", 41);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 38)(7, \"label\", 42);\n    i0.ɵɵtext(8, \"Unique Code\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"input\", 43);\n    i0.ɵɵtemplate(10, TemplateDetailsComponent_ng_template_36_div_10_Template, 3, 2, \"div\", 41);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 44)(12, \"button\", 45);\n    i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_ng_template_36_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r34);\n      i0.ɵɵnextContext();\n      const _r1 = i0.ɵɵreference(33);\n      return i0.ɵɵresetView(_r1.close());\n    });\n    i0.ɵɵtext(13, \"Cancel\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"button\", 46);\n    i0.ɵɵtext(15, \"Save\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r5.params);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.params.controls[\"title\"].invalid && ctx_r5.params.controls[\"title\"].touched);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.params.controls[\"uniqeCode\"].invalid && ctx_r5.params.controls[\"uniqeCode\"].touched);\n  }\n}\nconst _c2 = function (a0) {\n  return {\n    \"bg-primary text-white\": a0\n  };\n};\nexport class TemplateDetailsComponent {\n  constructor(fb, templateService) {\n    this.fb = fb;\n    this.templateService = templateService;\n    this.selectedTemplateId = null;\n    this.selectedSectionId = null;\n    this.templateList = [];\n    this.initSectionForm();\n    this.initFieldForm();\n  }\n  initSectionForm() {\n    this.sectionParams = this.fb.group({\n      id: [0],\n      title: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(100)]],\n      type: ['', Validators.required]\n    });\n  }\n  initFieldForm() {\n    this.fieldParams = this.fb.group({\n      id: [0],\n      title: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(100)]],\n      type: ['', Validators.required],\n      isRequired: [false]\n    });\n  }\n  // Section methods\n  editSection(templateId, section = null) {\n    this.selectedTemplateId = templateId;\n    this.addSectionModal.open();\n    this.initSectionForm();\n    if (section) {\n      this.sectionParams.setValue({\n        id: section.id,\n        title: section.title,\n        type: section.type\n      });\n    }\n  }\n  saveSection() {\n    if (this.sectionParams.invalid) {\n      this.showMessage('Please fill all required fields.', 'error');\n      return;\n    }\n    const section = this.sectionParams.value;\n    const templateId = this.selectedTemplateId;\n    if (templateId !== null) {\n      const addSectionDTO = {\n        title: section.title,\n        type: this.mapSectionType(section.type)\n      };\n      if (section.id) {\n        this.templateService.updateSection(templateId.toString(), section.id.toString(), addSectionDTO).subscribe(() => {\n          const template = this.templateList.find(t => t.id === templateId);\n          if (template && template.sections) {\n            const existingSection = template.sections.find(s => s.id === section.id);\n            if (existingSection) {\n              Object.assign(existingSection, section);\n            }\n          }\n          this.showMessage('Section has been updated successfully.');\n          this.addSectionModal.close();\n        }, error => this.handleErrorResponse(error));\n      } else {\n        this.templateService.addSection(templateId.toString(), addSectionDTO).subscribe(newSection => {\n          const template = this.templateList.find(t => t.id === templateId);\n          if (template) {\n            if (!template.sections) {\n              template.sections = [];\n            }\n            template.sections.push(newSection);\n          }\n          this.showMessage('Section has been added successfully.');\n          this.addSectionModal.close();\n        }, error => this.handleErrorResponse(error));\n      }\n    }\n  }\n  mapSectionType(type) {\n    const sectionTypeMap = {\n      'Form': 0,\n      'Table': 1\n    };\n    return sectionTypeMap[type] ?? 0;\n  }\n  handleErrorResponse(error) {\n    console.error('Error response:', error);\n    console.error('Error details:', JSON.stringify(error.error));\n    this.showMessage(error.error?.message || 'An unknown error occurred!', 'error');\n  }\n  showMessage(msg, type = 'success') {\n    Swal.fire({\n      icon: type,\n      title: msg,\n      toast: true,\n      position: 'top',\n      showConfirmButton: false,\n      timer: 3000,\n      customClass: {\n        container: 'toast'\n      }\n    });\n  }\n  deleteSection(templateId, sectionId) {\n    this.templateService.deleteSection(templateId.toString(), sectionId.toString()).subscribe(() => {\n      const template = this.templateList.find(t => t.id === templateId);\n      if (template && template.sections) {\n        template.sections = template.sections.filter(s => s.id !== sectionId);\n      }\n      this.showMessage('Section has been deleted successfully.');\n    }, error => {\n      this.showMessage(error, 'error');\n    });\n  }\n  loadSections(templateId) {\n    this.templateService.getTemplateById(templateId.toString()).subscribe(template => {\n      const existingTemplate = this.templateList.find(t => t.id === templateId);\n      if (existingTemplate) {\n        existingTemplate.sections = template.sections;\n      }\n    });\n  }\n  getTemplateIdBySectionId(sectionId) {\n    for (const template of this.templateList) {\n      if (template.sections) {\n        for (const section of template.sections) {\n          if (section.id === sectionId) {\n            return template.id;\n          }\n        }\n      }\n    }\n    return undefined;\n  }\n  // Field methods\n  editField(section, field = null) {\n    this.selectedSectionId = section.id;\n    const templateId = this.getTemplateIdBySectionId(section.id);\n    this.selectedTemplateId = templateId !== undefined ? templateId : null;\n    this.addFieldModal.open();\n    this.initFieldForm();\n    if (field) {\n      this.fieldParams.setValue({\n        id: field.id,\n        title: field.title,\n        type: field.type,\n        isRequired: field.isRequired\n      });\n    }\n  }\n  saveField() {\n    if (this.fieldParams.invalid) {\n      this.showMessage('Please fill all required fields.', 'error');\n      return;\n    }\n    const field = this.fieldParams.value;\n    const sectionId = this.selectedSectionId;\n    const templateId = this.selectedTemplateId;\n    if (templateId != null && sectionId != null) {\n      const addFieldDTO = {\n        title: field.title,\n        type: this.mapFieldType(field.type),\n        isRequired: field.isRequired\n      };\n      if (field.id != null && field.id !== 0) {\n        // In saveField() update case\n        this.templateService.updateField(templateId.toString(), sectionId.toString(), field.id.toString(), addFieldDTO).subscribe(updatedField => {\n          // Find and update the local field\n          const template = this.templateList.find(t => t.id === templateId);\n          const section = template?.sections?.find(s => s.id === sectionId);\n          if (section?.fields) {\n            const index = section.fields.findIndex(f => f.id === updatedField.id);\n            if (index > -1) {\n              section.fields = [...section.fields.slice(0, index), updatedField, ...section.fields.slice(index + 1)];\n            }\n          }\n          this.showMessage('Field updated successfully');\n          this.addFieldModal.close();\n        }, error => this.handleErrorResponse(error));\n      } else {\n        // In saveField() add case\n        this.templateService.addField(templateId.toString(), sectionId.toString(), addFieldDTO).subscribe(newField => {\n          // Find and update the local data\n          const template = this.templateList.find(t => t.id === templateId);\n          const section = template?.sections?.find(s => s.id === sectionId);\n          if (section) {\n            if (!section.fields) section.fields = [];\n            section.fields = [...section.fields, newField]; // Immutable update\n          }\n\n          this.showMessage('Field added successfully');\n          this.addFieldModal.close();\n        }, error => this.handleErrorResponse(error));\n      }\n    } else {\n      this.showMessage('Template ID or Section ID is missing.', 'error');\n    }\n  }\n  mapFieldType(type) {\n    const fieldTypeMap = {\n      'Text': 0,\n      'Number': 1,\n      'Date': 2,\n      'Boolean': 3\n    };\n    return fieldTypeMap[type];\n  }\n  deleteField(section, fieldId) {\n    const templateId = this.getTemplateIdBySectionId(section.id);\n    if (templateId !== undefined) {\n      this.templateService.deleteField(templateId.toString(), section.id.toString(), fieldId.toString()).subscribe(() => {\n        const template = this.templateList.find(t => t.id === templateId);\n        const existingSection = template?.sections?.find(s => s.id === section.id);\n        if (existingSection && existingSection.fields) {\n          existingSection.fields = existingSection.fields.filter(f => f.id !== fieldId);\n        }\n        this.showMessage('Field has been deleted successfully.');\n      }, error => {\n        this.showMessage(error, 'error');\n      });\n    } else {\n      this.showMessage('Failed to delete field: Template ID is missing.', 'error');\n    }\n  }\n  loadFields(section) {\n    const templateId = this.selectedTemplateId;\n    if (templateId !== null) {\n      this.templateService.getSectionFields(templateId.toString(), section.id.toString()).subscribe(fields => {\n        section.fields = fields;\n      });\n    }\n  }\n  toggleSections(template) {\n    if (!template.sections) {\n      this.loadSections(template.id);\n    }\n    template.expanded = !template.expanded;\n  }\n  toggleFields(section) {\n    if (!section.fields) {\n      this.loadFields(section);\n    }\n    section.expanded = !section.expanded;\n  }\n  static #_ = this.ɵfac = function TemplateDetailsComponent_Factory(t) {\n    return new (t || TemplateDetailsComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.TemplateService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TemplateDetailsComponent,\n    selectors: [[\"app-template-details\"]],\n    viewQuery: function TemplateDetailsComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.addSectionModal = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.addFieldModal = _t.first);\n      }\n    },\n    inputs: {\n      template: \"template\"\n    },\n    decls: 42,\n    vars: 11,\n    consts: [[1, \"flex\", \"flex-wrap\", \"items-center\", \"justify-between\", \"gap-4\"], [1, \"text-xl\"], [1, \"flex\", \"w-full\", \"flex-col\", \"gap-4\", \"sm:w-auto\", \"sm:flex-row\", \"sm:items-center\", \"sm:gap-3\"], [1, \"flex\", \"gap-3\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"ltr:mr-2\", \"rtl:ml-2\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-primary\", \"p-2\", 3, \"ngClass\", \"click\"], [1, \"relative\"], [\"type\", \"text\", \"placeholder\", \"Search Templates\", \"name\", \"searchTemplate\", 1, \"peer\", \"form-input\", \"py-2\", \"ltr:pr-11\", \"rtl:pl-11\", 3, \"ngModel\", \"ngModelChange\"], [1, \"absolute\", \"top-1/2\", \"-translate-y-1/2\", \"peer-focus:text-primary\", \"ltr:right-[11px]\", \"rtl:left-[11px]\"], [1, \"mx-auto\"], [1, \"panel\", \"mt-5\", \"overflow-hidden\", \"border-0\", \"p-0\"], [1, \"bg-white\", \"p-6\", \"shadow\", \"rounded-md\"], [1, \"text-white-dark\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-secondary\", \"mt-4\", 3, \"click\"], [4, \"ngIf\"], [1, \"no-footer\"], [\"addTemplateModal\", \"\"], [\"modalHeader\", \"\"], [\"modalBody\", \"\"], [\"addSectionModal\", \"\"], [\"addFieldModal\", \"\"], [1, \"table-responsive\"], [1, \"table-striped\", \"table-hover\"], [1, \"!text-center\"], [\"key\", \"section.id\", 4, \"ngFor\", \"ngForOf\"], [\"key\", \"section.id\"], [1, \"flex\", \"items-center\", \"justify-center\", \"gap-4\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-primary\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-danger\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-secondary\", 3, \"click\"], [\"colspan\", \"3\"], [\"key\", \"field.id\", 4, \"ngFor\", \"ngForOf\"], [\"colspan\", \"4\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-success\", 3, \"click\"], [\"key\", \"field.id\"], [1, \"!font-medium\"], [\"ngNativeValidate\", \"\", 1, \"text-sm\", 3, \"formGroup\", \"ngSubmit\"], [1, \"mb-5\"], [\"for\", \"title\"], [\"id\", \"title\", \"type\", \"text\", \"placeholder\", \"Enter Title\", \"formControlName\", \"title\", 1, \"form-input\"], [\"class\", \"text-red-500\", 4, \"ngIf\"], [\"for\", \"uniqeCode\"], [\"id\", \"uniqeCode\", \"type\", \"text\", \"placeholder\", \"Enter Unique Code\", \"formControlName\", \"uniqeCode\", 1, \"form-input\"], [1, \"mt-8\", \"flex\", \"items-center\", \"justify-end\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-danger\", 3, \"click\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"ltr:ml-4\", \"rtl:ml-4\"], [1, \"text-red-500\"]],\n    template: function TemplateDetailsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\")(1, \"div\", 0)(2, \"h2\", 1);\n        i0.ɵɵtext(3, \"Templates\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 2)(5, \"div\", 3)(6, \"div\")(7, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_Template_button_click_7_listener() {\n          return ctx.editTemplate();\n        });\n        i0.ɵɵelement(8, \"icon-user-plus\", 5);\n        i0.ɵɵtext(9, \" Add Template \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"div\")(11, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_Template_button_click_11_listener() {\n          return ctx.displayType = \"list\";\n        });\n        i0.ɵɵelement(12, \"icon-list-check\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(13, \"div\")(14, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_Template_button_click_14_listener() {\n          return ctx.displayType = \"grid\";\n        });\n        i0.ɵɵelement(15, \"icon-layout-grid\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(16, \"div\", 7)(17, \"input\", 8);\n        i0.ɵɵlistener(\"ngModelChange\", function TemplateDetailsComponent_Template_input_ngModelChange_17_listener($event) {\n          return ctx.searchTemplate = $event;\n        })(\"ngModelChange\", function TemplateDetailsComponent_Template_input_ngModelChange_17_listener() {\n          return ctx.searchTemplates();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"div\", 9);\n        i0.ɵɵelement(19, \"icon-search\", 10);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(20, \"div\", 11)(21, \"div\", 12)(22, \"div\", 1);\n        i0.ɵɵtext(23);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"div\", 13);\n        i0.ɵɵtext(25);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"div\", 13);\n        i0.ɵɵtext(27);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"button\", 14);\n        i0.ɵɵlistener(\"click\", function TemplateDetailsComponent_Template_button_click_28_listener() {\n          return ctx.goBackToList();\n        });\n        i0.ɵɵtext(29, \"Back to List\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(30, \"div\", 11);\n        i0.ɵɵtemplate(31, TemplateDetailsComponent_ng_container_31_Template, 13, 1, \"ng-container\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"modal\", 16, 17);\n        i0.ɵɵtemplate(34, TemplateDetailsComponent_ng_template_34_Template, 2, 1, \"ng-template\", null, 18, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(36, TemplateDetailsComponent_ng_template_36_Template, 16, 3, \"ng-template\", null, 19, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(38, \"modal\", 16, 20)(40, \"modal\", 16, 21);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(7, _c2, ctx.displayType === \"list\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(9, _c2, ctx.displayType === \"grid\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.searchTemplate);\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate(ctx.template.title);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\"ID: \", ctx.template.id, \"\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\"Unique Code: \", ctx.template.uniqeCode, \"\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.displayType === \"list\");\n      }\n    },\n    dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.NgModel, i4.ModalComponent, i1.FormGroupDirective, i1.FormControlName, i5.IconLayoutGridComponent, i6.IconListCheckComponent, i7.IconSearchComponent, i8.IconUserPlusComponent],\n    encapsulation: 2\n  });\n}","map":{"version":3,"mappings":"AACA,SAAiCA,UAAU,QAAQ,gBAAgB;AAEnE,OAAOC,IAAI,MAAM,aAAa;;;;;;;;;;;;;;;ICoGkBC,iCAAkE;IAC9DA,0BAAI;IACIA,YAAiB;IAAAA,iBAAK;IAC1BA,0BAAI;IAAAA,YAAgB;IAAAA,iBAAK;IACzBA,0BAAI;IAAAA,YAAqC;IAAAA,iBAAK;IAC9CA,0BAAI;IAEiEA;MAAA;MAAA;MAAA;MAAA;MAAA,OAASA,uDAAyB;IAAA,EAAC;IAACA,2BAAU;IAAAA,iBAAS;IACpHA,mCAAqG;IAAzCA;MAAA;MAAA;MAAA;MAAA;MAAA,OAASA,4DAA8B;IAAA,EAAC;IAACA,6BAAY;IAAAA,iBAAS;IAI1IA,0BAAe;;;;IAVHA,eAAiB;IAAjBA,qCAAiB;IACjBA,eAAgB;IAAhBA,oCAAgB;IAChBA,eAAqC;IAArCA,yDAAqC;;;;;;IAjBrEA,0BAA+C;IAMnBA,2BAAW;IAAAA,iBAAK;IACpBA,0BAAI;IAAAA,oBAAI;IAAAA,iBAAK;IACbA,2BAAI;IAAAA,yBAAQ;IAAAA,iBAAK;IACjBA,+BAAyB;IAAAA,wBAAO;IAAAA,iBAAK;IAG7CA,8BAAO;IACHA,qIAYe;IACfA,2BAAI;IAEiEA;MAAAA;MAAA;MAAA;MAAA,OAASA,4CAAkB;IAAA,EAAC;IAACA,0BAAS;IAAAA,iBAAS;;;;IAfpFA,gBAAiB;IAAjBA,2CAAiB;;;;;;IA/BzEA,iCAAyE;IACrEA,0BAAI;IACIA,YAAmB;IAAAA,iBAAK;IAC5BA,0BAAI;IAAAA,YAAkB;IAAAA,iBAAK;IAC3BA,0BAAI;IAEiEA;MAAA;MAAA;MAAA;MAAA,OAASA,mEAAiC;IAAA,EAAC;IAACA,4BAAY;IAAAA,iBAAS;IAC9HA,mCAA6G;IAAjDA;MAAA;MAAA;MAAA;MAAA,OAASA,wEAAsC;IAAA,EAAC;IAACA,+BAAc;IAAAA,iBAAS;IACpIA,mCAIC;IADCA;MAAA;MAAA;MAAA;MAAA,OAASA,+CAAqB;IAAA,EAAC;IAE/BA,aACF;IAAAA,iBAAS;IAIrBA,2GAmCK;IACTA,0BAAe;;;;IApDHA,eAAmB;IAAnBA,sCAAmB;IACnBA,eAAkB;IAAlBA,qCAAkB;IAUZA,eACF;IADEA,oFACF;IAIPA,eAAwC;IAAxCA,+DAAwC;;;;;IA7BjEA,6BAA6C;IACzCA,+BAA8B;IAIVA,6BAAa;IAAAA,iBAAK;IACtBA,0BAAI;IAAAA,oBAAI;IAAAA,iBAAK;IACbA,8BAAyB;IAAAA,wBAAO;IAAAA,iBAAK;IAG7CA,8BAAO;IACHA,+GAsDe;IACnBA,iBAAQ;IAGpBA,0BAAe;;;;IA1DmCA,gBAAoB;IAApBA,kDAAoB;;;;;IAgElEA,+BAA0B;IAAAA,YAAoE;IAAAA,iBAAM;;;;IAA1EA,eAAoE;IAApEA,2FAAoE;;;;;IAQlFA,2BAA2D;IAAAA,kCAAkB;IAAAA,iBAAM;;;;;IACnFA,2BAA4D;IAAAA,yDAAyC;IAAAA,iBAAM;;;;;IAC3GA,2BAA4D;IAAAA,8DAA8C;IAAAA,iBAAM;;;;;IAHpHA,+BAAuG;IACnGA,+FAAmF;IACnFA,+FAA2G;IAC3GA,+FAAgH;IACpHA,iBAAM;;;;IAHIA,eAAmD;IAAnDA,mIAAmD;IACnDA,eAAoD;IAApDA,oIAAoD;IACpDA,eAAoD;IAApDA,oIAAoD;;;;;IAO1DA,2BAA+D;IAAAA,wCAAwB;IAAAA,iBAAM;;;;;IAC7FA,2BAA8D;IAAAA,2DAA2C;IAAAA,iBAAM;;;;;IAFnHA,+BAA+G;IAC3GA,gGAA6F;IAC7FA,gGAA+G;IACnHA,iBAAM;;;;IAFIA,eAAuD;IAAvDA,2IAAuD;IACvDA,eAAsD;IAAtDA,0IAAsD;;;;;;IAfxEA,gCAAwF;IAA7CA;MAAAA;MAAA;MAAA,OAAYA,qCAAc;IAAA,EAAC;IAClEA,+BAAkB;IACKA,qBAAK;IAAAA,iBAAQ;IAChCA,4BAAqG;IACrGA,yFAIM;IACVA,iBAAM;IACNA,+BAAkB;IACSA,2BAAW;IAAAA,iBAAQ;IAC1CA,4BAAmH;IACnHA,2FAGM;IACVA,iBAAM;IACNA,gCAAgD;IACSA;MAAAA;MAAAA;MAAA;MAAA,OAASA,0BAAwB;IAAA,EAAC;IAACA,uBAAM;IAAAA,iBAAS;IACvGA,mCAAgE;IAAAA,qBAAI;IAAAA,iBAAS;;;;IApB/EA,yCAAoB;IAIZA,eAA0E;IAA1EA,yGAA0E;IAS1EA,eAAkF;IAAlFA,iHAAkF;;;;;;;;AD3I5G,OAAM,MAAOC,wBAAwB;EAkBnCC,YAAoBC,EAAe,EAAUC,eAAgC;IAAzD,OAAE,GAAFD,EAAE;IAAuB,oBAAe,GAAfC,eAAe;IAP5D,uBAAkB,GAAkB,IAAI;IACxC,sBAAiB,GAAkB,IAAI;IACvC,iBAAY,GAAe,EAAE;IAM3B,IAAI,CAACC,eAAe,EAAE;IACtB,IAAI,CAACC,aAAa,EAAE;EACtB;EAEAD,eAAe;IACb,IAAI,CAACE,aAAa,GAAG,IAAI,CAACJ,EAAE,CAACK,KAAK,CAAC;MACjCC,EAAE,EAAE,CAAC,CAAC,CAAC;MACPC,KAAK,EAAE,CAAC,EAAE,EAAE,CAACZ,UAAU,CAACa,QAAQ,EAAEb,UAAU,CAACc,SAAS,CAAC,CAAC,CAAC,EAAEd,UAAU,CAACe,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;MACtFC,IAAI,EAAE,CAAC,EAAE,EAAEhB,UAAU,CAACa,QAAQ;KAC/B,CAAC;EACJ;EAEAL,aAAa;IACX,IAAI,CAACS,WAAW,GAAG,IAAI,CAACZ,EAAE,CAACK,KAAK,CAAC;MAC/BC,EAAE,EAAE,CAAC,CAAC,CAAC;MACPC,KAAK,EAAE,CAAC,EAAE,EAAE,CAACZ,UAAU,CAACa,QAAQ,EAAEb,UAAU,CAACc,SAAS,CAAC,CAAC,CAAC,EAAEd,UAAU,CAACe,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;MACtFC,IAAI,EAAE,CAAC,EAAE,EAAEhB,UAAU,CAACa,QAAQ,CAAC;MAC/BK,UAAU,EAAE,CAAC,KAAK;KACnB,CAAC;EACJ;EAEA;EACAC,WAAW,CAACC,UAAkB,EAAEC,UAA0B,IAAI;IAC5D,IAAI,CAACC,kBAAkB,GAAGF,UAAU;IACpC,IAAI,CAACG,eAAe,CAACC,IAAI,EAAE;IAC3B,IAAI,CAACjB,eAAe,EAAE;IACtB,IAAIc,OAAO,EAAE;MACX,IAAI,CAACZ,aAAa,CAACgB,QAAQ,CAAC;QAC1Bd,EAAE,EAAEU,OAAO,CAACV,EAAE;QACdC,KAAK,EAAES,OAAO,CAACT,KAAK;QACpBI,IAAI,EAAEK,OAAO,CAACL;OACf,CAAC;;EAEN;EAEAU,WAAW;IACT,IAAI,IAAI,CAACjB,aAAa,CAACkB,OAAO,EAAE;MAC9B,IAAI,CAACC,WAAW,CAAC,kCAAkC,EAAE,OAAO,CAAC;MAC7D;;IAGF,MAAMP,OAAO,GAAY,IAAI,CAACZ,aAAa,CAACoB,KAAK;IACjD,MAAMT,UAAU,GAAG,IAAI,CAACE,kBAAkB;IAI1C,IAAIF,UAAU,KAAK,IAAI,EAAE;MACvB,MAAMU,aAAa,GAAG;QACpBlB,KAAK,EAAES,OAAO,CAACT,KAAK;QACpBI,IAAI,EAAE,IAAI,CAACe,cAAc,CAACV,OAAO,CAACL,IAAI;OACvC;MAID,IAAIK,OAAO,CAACV,EAAE,EAAE;QAEd,IAAI,CAACL,eAAe,CAAC0B,aAAa,CAACZ,UAAU,CAACa,QAAQ,EAAE,EAAEZ,OAAO,CAACV,EAAE,CAACsB,QAAQ,EAAE,EAAEH,aAAa,CAAC,CAC5FI,SAAS,CACR,MAAK;UACH,MAAMC,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3B,EAAE,KAAKS,UAAU,CAAC;UACjE,IAAIe,QAAQ,IAAIA,QAAQ,CAACI,QAAQ,EAAE;YACjC,MAAMC,eAAe,GAAGL,QAAQ,CAACI,QAAQ,CAACF,IAAI,CAACI,CAAC,IAAIA,CAAC,CAAC9B,EAAE,KAAKU,OAAO,CAACV,EAAE,CAAC;YACxE,IAAI6B,eAAe,EAAE;cACnBE,MAAM,CAACC,MAAM,CAACH,eAAe,EAAEnB,OAAO,CAAC;;;UAG3C,IAAI,CAACO,WAAW,CAAC,wCAAwC,CAAC;UAC1D,IAAI,CAACL,eAAe,CAACqB,KAAK,EAAE;QAC9B,CAAC,EACAC,KAAK,IAAK,IAAI,CAACC,mBAAmB,CAACD,KAAK,CAAC,CAC3C;OACJ,MAAM;QAEL,IAAI,CAACvC,eAAe,CAACyC,UAAU,CAAC3B,UAAU,CAACa,QAAQ,EAAE,EAAEH,aAAa,CAAC,CAClEI,SAAS,CACPc,UAAU,IAAI;UACb,MAAMb,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3B,EAAE,KAAKS,UAAU,CAAC;UACjE,IAAIe,QAAQ,EAAE;YACZ,IAAI,CAACA,QAAQ,CAACI,QAAQ,EAAE;cACtBJ,QAAQ,CAACI,QAAQ,GAAG,EAAE;;YAExBJ,QAAQ,CAACI,QAAQ,CAACU,IAAI,CAACD,UAAU,CAAC;;UAEpC,IAAI,CAACpB,WAAW,CAAC,sCAAsC,CAAC;UACxD,IAAI,CAACL,eAAe,CAACqB,KAAK,EAAE;QAC9B,CAAC,EACAC,KAAK,IAAK,IAAI,CAACC,mBAAmB,CAACD,KAAK,CAAC,CAC3C;;;EAGT;EAGQd,cAAc,CAACf,IAAS;IAC9B,MAAMkC,cAAc,GAA8B;MAChD,MAAM,EAAE,CAAC;MACT,OAAO,EAAE;KACV;IACD,OAAOA,cAAc,CAAClC,IAAI,CAAC,IAAI,CAAC;EAClC;EACQ8B,mBAAmB,CAACD,KAAU;IACpCM,OAAO,CAACN,KAAK,CAAC,iBAAiB,EAAEA,KAAK,CAAC;IACvCM,OAAO,CAACN,KAAK,CAAC,gBAAgB,EAAEO,IAAI,CAACC,SAAS,CAACR,KAAK,CAACA,KAAK,CAAC,CAAC;IAC5D,IAAI,CAACjB,WAAW,CAACiB,KAAK,CAACA,KAAK,EAAES,OAAO,IAAI,4BAA4B,EAAE,OAAO,CAAC;EACjF;EAGA1B,WAAW,CAAC2B,GAAW,EAAEvC,OAA4B,SAAS;IAC5Df,IAAI,CAACuD,IAAI,CAAC;MACRC,IAAI,EAAEzC,IAAI;MACVJ,KAAK,EAAE2C,GAAG;MACVG,KAAK,EAAE,IAAI;MACXC,QAAQ,EAAE,KAAK;MACfC,iBAAiB,EAAE,KAAK;MACxBC,KAAK,EAAE,IAAI;MACXC,WAAW,EAAE;QAAEC,SAAS,EAAE;MAAO;KAClC,CAAC;EACJ;EACEC,aAAa,CAAC5C,UAAkB,EAAE6C,SAAiB;IACjD,IAAI,CAAC3D,eAAe,CAAC0D,aAAa,CAAC5C,UAAU,CAACa,QAAQ,EAAE,EAAEgC,SAAS,CAAChC,QAAQ,EAAE,CAAC,CAACC,SAAS,CAAC,MAAK;MAC7F,MAAMC,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3B,EAAE,KAAKS,UAAU,CAAC;MACjE,IAAIe,QAAQ,IAAIA,QAAQ,CAACI,QAAQ,EAAE;QACjCJ,QAAQ,CAACI,QAAQ,GAAGJ,QAAQ,CAACI,QAAQ,CAAC2B,MAAM,CAACzB,CAAC,IAAIA,CAAC,CAAC9B,EAAE,KAAKsD,SAAS,CAAC;;MAEvE,IAAI,CAACrC,WAAW,CAAC,wCAAwC,CAAC;IAC5D,CAAC,EAAEiB,KAAK,IAAG;MACT,IAAI,CAACjB,WAAW,CAACiB,KAAK,EAAE,OAAO,CAAC;IAClC,CAAC,CAAC;EACJ;EACAsB,YAAY,CAAC/C,UAAkB;IAC7B,IAAI,CAACd,eAAe,CAAC8D,eAAe,CAAChD,UAAU,CAACa,QAAQ,EAAE,CAAC,CAACC,SAAS,CAAEC,QAAQ,IAAI;MACjF,MAAMkC,gBAAgB,GAAG,IAAI,CAACjC,YAAY,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3B,EAAE,KAAKS,UAAU,CAAC;MACzE,IAAIiD,gBAAgB,EAAE;QACpBA,gBAAgB,CAAC9B,QAAQ,GAAGJ,QAAQ,CAACI,QAAQ;;IAEjD,CAAC,CAAC;EACJ;EACA+B,wBAAwB,CAACL,SAAiB;IACxC,KAAK,MAAM9B,QAAQ,IAAI,IAAI,CAACC,YAAY,EAAE;MACxC,IAAID,QAAQ,CAACI,QAAQ,EAAE;QACrB,KAAK,MAAMlB,OAAO,IAAIc,QAAQ,CAACI,QAAQ,EAAE;UACvC,IAAIlB,OAAO,CAACV,EAAE,KAAKsD,SAAS,EAAE;YAC5B,OAAO9B,QAAQ,CAACxB,EAAE;;;;;IAK1B,OAAO4D,SAAS;EAClB;EAGF;EACAC,SAAS,CAACnD,OAAgB,EAAEoD,QAAsB,IAAI;IACpD,IAAI,CAACC,iBAAiB,GAAGrD,OAAO,CAACV,EAAE;IACnC,MAAMS,UAAU,GAAG,IAAI,CAACkD,wBAAwB,CAACjD,OAAO,CAACV,EAAE,CAAC;IAC5D,IAAI,CAACW,kBAAkB,GAAGF,UAAU,KAAKmD,SAAS,GAAGnD,UAAU,GAAG,IAAI;IACtE,IAAI,CAACuD,aAAa,CAACnD,IAAI,EAAE;IACzB,IAAI,CAAChB,aAAa,EAAE;IACpB,IAAIiE,KAAK,EAAE;MACT,IAAI,CAACxD,WAAW,CAACQ,QAAQ,CAAC;QACxBd,EAAE,EAAE8D,KAAK,CAAC9D,EAAE;QACZC,KAAK,EAAE6D,KAAK,CAAC7D,KAAK;QAClBI,IAAI,EAAEyD,KAAK,CAACzD,IAAI;QAChBE,UAAU,EAAEuD,KAAK,CAACvD;OACnB,CAAC;;EAEN;EAEA0D,SAAS;IAGP,IAAI,IAAI,CAAC3D,WAAW,CAACU,OAAO,EAAE;MAC5B,IAAI,CAACC,WAAW,CAAC,kCAAkC,EAAE,OAAO,CAAC;MAC7D;;IAGF,MAAM6C,KAAK,GAAU,IAAI,CAACxD,WAAW,CAACY,KAAK;IAC3C,MAAMoC,SAAS,GAAG,IAAI,CAACS,iBAAiB;IACxC,MAAMtD,UAAU,GAAG,IAAI,CAACE,kBAAkB;IAI1C,IAAIF,UAAU,IAAI,IAAI,IAAI6C,SAAS,IAAI,IAAI,EAAE;MAC3C,MAAMY,WAAW,GAAG;QAClBjE,KAAK,EAAE6D,KAAK,CAAC7D,KAAK;QAClBI,IAAI,EAAE,IAAI,CAAC8D,YAAY,CAACL,KAAK,CAACzD,IAAI,CAAC;QACnCE,UAAU,EAAEuD,KAAK,CAACvD;OACnB;MAID,IAAIuD,KAAK,CAAC9D,EAAE,IAAI,IAAI,IAAI8D,KAAK,CAAC9D,EAAE,KAAK,CAAC,EAAE;QAEvC;QACP,IAAI,CAACL,eAAe,CAACyE,WAAW,CAAC3D,UAAU,CAACa,QAAQ,EAAE,EAAEgC,SAAS,CAAChC,QAAQ,EAAE,EAAEwC,KAAK,CAAC9D,EAAE,CAACsB,QAAQ,EAAE,EAAE4C,WAAW,CAAC,CAC9G3C,SAAS,CACP8C,YAAY,IAAI;UACf;UACA,MAAM7C,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3B,EAAE,KAAKS,UAAU,CAAC;UACjE,MAAMC,OAAO,GAAGc,QAAQ,EAAEI,QAAQ,EAAEF,IAAI,CAACI,CAAC,IAAIA,CAAC,CAAC9B,EAAE,KAAKsD,SAAS,CAAC;UAEjE,IAAI5C,OAAO,EAAE4D,MAAM,EAAE;YACnB,MAAMC,KAAK,GAAG7D,OAAO,CAAC4D,MAAM,CAACE,SAAS,CAACC,CAAC,IAAIA,CAAC,CAACzE,EAAE,KAAKqE,YAAY,CAACrE,EAAE,CAAC;YACrE,IAAIuE,KAAK,GAAG,CAAC,CAAC,EAAE;cACd7D,OAAO,CAAC4D,MAAM,GAAG,CACf,GAAG5D,OAAO,CAAC4D,MAAM,CAACI,KAAK,CAAC,CAAC,EAAEH,KAAK,CAAC,EACjCF,YAAY,EACZ,GAAG3D,OAAO,CAAC4D,MAAM,CAACI,KAAK,CAACH,KAAK,GAAG,CAAC,CAAC,CACnC;;;UAIL,IAAI,CAACtD,WAAW,CAAC,4BAA4B,CAAC;UAC9C,IAAI,CAAC+C,aAAa,CAAC/B,KAAK,EAAE;QAC5B,CAAC,EACAC,KAAK,IAAK,IAAI,CAACC,mBAAmB,CAACD,KAAK,CAAC,CAC3C;OACM,MAAM;QAER;QACL,IAAI,CAACvC,eAAe,CAACgF,QAAQ,CAAClE,UAAU,CAACa,QAAQ,EAAE,EAAEgC,SAAS,CAAChC,QAAQ,EAAE,EAAE4C,WAAW,CAAC,CACtF3C,SAAS,CACPqD,QAAQ,IAAI;UACX;UACA,MAAMpD,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3B,EAAE,KAAKS,UAAU,CAAC;UACjE,MAAMC,OAAO,GAAGc,QAAQ,EAAEI,QAAQ,EAAEF,IAAI,CAACI,CAAC,IAAIA,CAAC,CAAC9B,EAAE,KAAKsD,SAAS,CAAC;UAEjE,IAAI5C,OAAO,EAAE;YACX,IAAI,CAACA,OAAO,CAAC4D,MAAM,EAAE5D,OAAO,CAAC4D,MAAM,GAAG,EAAE;YACxC5D,OAAO,CAAC4D,MAAM,GAAG,CAAC,GAAG5D,OAAO,CAAC4D,MAAM,EAAEM,QAAQ,CAAC,CAAC,CAAC;;;UAGlD,IAAI,CAAC3D,WAAW,CAAC,0BAA0B,CAAC;UAC5C,IAAI,CAAC+C,aAAa,CAAC/B,KAAK,EAAE;QAC5B,CAAC,EACAC,KAAK,IAAK,IAAI,CAACC,mBAAmB,CAACD,KAAK,CAAC,CAC3C;;KAEI,MAAM;MACL,IAAI,CAACjB,WAAW,CAAC,uCAAuC,EAAE,OAAO,CAAC;;EAEtE;EAGQkD,YAAY,CAAC9D,IAAS;IAC5B,MAAMwE,YAAY,GAA8B;MAC9C,MAAM,EAAE,CAAC;MACT,QAAQ,EAAE,CAAC;MACX,MAAM,EAAE,CAAC;MACT,SAAS,EAAE;KACZ;IACD,OAAOA,YAAY,CAACxE,IAAI,CAAC;EAC3B;EACAyE,WAAW,CAACpE,OAAgB,EAAEqE,OAAe;IAC3C,MAAMtE,UAAU,GAAG,IAAI,CAACkD,wBAAwB,CAACjD,OAAO,CAACV,EAAE,CAAC;IAI5D,IAAIS,UAAU,KAAKmD,SAAS,EAAE;MAC5B,IAAI,CAACjE,eAAe,CAACmF,WAAW,CAACrE,UAAU,CAACa,QAAQ,EAAE,EAAEZ,OAAO,CAACV,EAAE,CAACsB,QAAQ,EAAE,EAAEyD,OAAO,CAACzD,QAAQ,EAAE,CAAC,CAACC,SAAS,CAAC,MAAK;QAChH,MAAMC,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3B,EAAE,KAAKS,UAAU,CAAC;QACjE,MAAMoB,eAAe,GAAGL,QAAQ,EAAEI,QAAQ,EAAEF,IAAI,CAACI,CAAC,IAAIA,CAAC,CAAC9B,EAAE,KAAKU,OAAO,CAACV,EAAE,CAAC;QAC1E,IAAI6B,eAAe,IAAIA,eAAe,CAACyC,MAAM,EAAE;UAC7CzC,eAAe,CAACyC,MAAM,GAAGzC,eAAe,CAACyC,MAAM,CAACf,MAAM,CAACkB,CAAC,IAAIA,CAAC,CAACzE,EAAE,KAAK+E,OAAO,CAAC;;QAE/E,IAAI,CAAC9D,WAAW,CAAC,sCAAsC,CAAC;MAC1D,CAAC,EAAEiB,KAAK,IAAG;QACT,IAAI,CAACjB,WAAW,CAACiB,KAAK,EAAE,OAAO,CAAC;MAClC,CAAC,CAAC;KACH,MAAM;MACL,IAAI,CAACjB,WAAW,CAAC,iDAAiD,EAAE,OAAO,CAAC;;EAEhF;EAGA+D,UAAU,CAACtE,OAAgB;IACzB,MAAMD,UAAU,GAAG,IAAI,CAACE,kBAAkB;IAC1C,IAAIF,UAAU,KAAK,IAAI,EAAE;MACvB,IAAI,CAACd,eAAe,CAACsF,gBAAgB,CAACxE,UAAU,CAACa,QAAQ,EAAE,EAAEZ,OAAO,CAACV,EAAE,CAACsB,QAAQ,EAAE,CAAC,CAACC,SAAS,CAAE+C,MAAM,IAAI;QACvG5D,OAAO,CAAC4D,MAAM,GAAGA,MAAM;MACzB,CAAC,CAAC;;EAEN;EAEAY,cAAc,CAAC1D,QAAa;IAC1B,IAAI,CAACA,QAAQ,CAACI,QAAQ,EAAE;MACtB,IAAI,CAAC4B,YAAY,CAAChC,QAAQ,CAACxB,EAAE,CAAC;;IAEhCwB,QAAQ,CAAC2D,QAAQ,GAAG,CAAC3D,QAAQ,CAAC2D,QAAQ;EACxC;EAEAC,YAAY,CAAC1E,OAAY;IACvB,IAAI,CAACA,OAAO,CAAC4D,MAAM,EAAE;MACnB,IAAI,CAACU,UAAU,CAACtE,OAAO,CAAC;;IAE1BA,OAAO,CAACyE,QAAQ,GAAG,CAACzE,OAAO,CAACyE,QAAQ;EACtC;EAAC;qBA3TU3F,wBAAwB;EAAA;EAAA;UAAxBA,wBAAwB;IAAA6F;IAAAC;MAAA;;;;;;;;;;;;;;;;;;QCbrC/F,2BAAK;QAEuBA,yBAAS;QAAAA,iBAAK;QAClCA,8BAAuF;QAG7BA;UAAA,OAASgG,kBAAc;QAAA,EAAC;QAClEhG,oCAA4C;QAC5CA,8BACJ;QAAAA,iBAAS;QAEbA,4BAAK;QAKGA;UAAA,yBAAuB,MAAM;QAAA,EAAC;QAE9BA,mCAAmB;QACvBA,iBAAS;QAEbA,4BAAK;QAKGA;UAAA,yBAAuB,MAAM;QAAA,EAAC;QAE9BA,oCAAoB;QACxBA,iBAAS;QAIjBA,+BAAsB;QAKdA;UAAA;QAAA,EAA4B;UAAA,OAEXgG,qBAAiB;QAAA,EAFN;QAJhChG,iBAOE;QACFA,+BAAwG;QACpGA,mCAA+B;QACnCA,iBAAM;QAMlBA,gCAAqD;QAExBA,aAAoB;QAAAA,iBAAM;QAC/CA,gCAA6B;QAAAA,aAAqB;QAAAA,iBAAM;QACxDA,gCAA6B;QAAAA,aAAqC;QAAAA,iBAAM;QACxEA,mCAAsF;QAAzBA;UAAA,OAASgG,kBAAc;QAAA,EAAC;QAAChG,6BAAY;QAAAA,iBAAS;QAKnHA,gCAAqD;QACjDA,+FAqEe;QACnBA,iBAAM;QAGNA,sCAA2C;QACvCA,6HAEc;QACdA,8HAwBc;QAClBA,iBAAQ;QAERA,iCAEQ;QAMZA,iBAAM;;;QA9JkBA,gBAA+D;QAA/DA,gFAA+D;QAU/DA,eAA+D;QAA/DA,gFAA+D;QAanEA,eAA4B;QAA5BA,4CAA4B;QAcfA,eAAoB;QAApBA,wCAAoB;QACZA,eAAqB;QAArBA,kDAAqB;QACrBA,eAAqC;QAArCA,kEAAqC;QAOvDA,eAA4B;QAA5BA,iDAA4B","names":["Validators","Swal","i0","TemplateDetailsComponent","constructor","fb","templateService","initSectionForm","initFieldForm","sectionParams","group","id","title","required","minLength","maxLength","type","fieldParams","isRequired","editSection","templateId","section","selectedTemplateId","addSectionModal","open","setValue","saveSection","invalid","showMessage","value","addSectionDTO","mapSectionType","updateSection","toString","subscribe","template","templateList","find","t","sections","existingSection","s","Object","assign","close","error","handleErrorResponse","addSection","newSection","push","sectionTypeMap","console","JSON","stringify","message","msg","fire","icon","toast","position","showConfirmButton","timer","customClass","container","deleteSection","sectionId","filter","loadSections","getTemplateById","existingTemplate","getTemplateIdBySectionId","undefined","editField","field","selectedSectionId","addFieldModal","saveField","addFieldDTO","mapFieldType","updateField","updatedField","fields","index","findIndex","f","slice","addField","newField","fieldTypeMap","deleteField","fieldId","loadFields","getSectionFields","toggleSections","expanded","toggleFields","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["C:\\Users\\Electronica Care\\Downloads\\QRCodeGenerator-main\\QR-Generator\\src\\app\\qrtemplategenerator\\components\\template-details\\template-details.component.ts","C:\\Users\\Electronica Care\\Downloads\\QRCodeGenerator-main\\QR-Generator\\src\\app\\qrtemplategenerator\\components\\template-details\\template-details.component.html"],"sourcesContent":["import { Component, Input, ViewChild } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { ModalComponent } from 'angular-custom-modal';\nimport Swal from 'sweetalert2';\nimport { TemplateService } from 'src/app/qrtemplategenerator/services/template.service';\nimport { Template } from 'src/app/qrtemplategenerator/Models/Template';\nimport { Section } from 'src/app/qrtemplategenerator/Models/Section';\nimport { Field } from 'src/app/qrtemplategenerator/Models/Field';\n\n@Component({\n  selector: 'app-template-details',\n  templateUrl: './template-details.component.html'\n})\nexport class TemplateDetailsComponent {\n  @Input() template!: Template;\n  @ViewChild('addSectionModal') addSectionModal!: ModalComponent;\n  @ViewChild('addFieldModal') addFieldModal!: ModalComponent;\n\n  sectionParams!: FormGroup;\n  fieldParams!: FormGroup;\n  selectedSection?: Section;\n\n\n  \n  selectedTemplateId: number | null = null;\n  selectedSectionId: number | null = null;\n  templateList: Template[] = [];\n\n\n  \n\n  constructor(private fb: FormBuilder, private templateService: TemplateService) {\n    this.initSectionForm();\n    this.initFieldForm();\n  }\n\n  initSectionForm() {\n    this.sectionParams = this.fb.group({\n      id: [0],\n      title: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(100)]],\n      type: ['', Validators.required],\n    });\n  }\n\n  initFieldForm() {\n    this.fieldParams = this.fb.group({\n      id: [0],\n      title: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(100)]],\n      type: ['', Validators.required],\n      isRequired: [false],\n    });\n  }\n\n  // Section methods\n  editSection(templateId: number, section: Section | null = null) {\n    this.selectedTemplateId = templateId;\n    this.addSectionModal.open();\n    this.initSectionForm();\n    if (section) {\n      this.sectionParams.setValue({\n        id: section.id,\n        title: section.title,\n        type: section.type,\n      });\n    }\n  }\n\n  saveSection() {\n    if (this.sectionParams.invalid) {\n      this.showMessage('Please fill all required fields.', 'error');\n      return;\n    }\n  \n    const section: Section = this.sectionParams.value;\n    const templateId = this.selectedTemplateId;\n  \n    \n  \n    if (templateId !== null) {\n      const addSectionDTO = {\n        title: section.title,\n        type: this.mapSectionType(section.type) \n      };\n  \n   \n  \n      if (section.id) {\n       \n        this.templateService.updateSection(templateId.toString(), section.id.toString(), addSectionDTO)\n          .subscribe(\n            () => {\n              const template = this.templateList.find(t => t.id === templateId);\n              if (template && template.sections) {\n                const existingSection = template.sections.find(s => s.id === section.id);\n                if (existingSection) {\n                  Object.assign(existingSection, section);\n                }\n              }\n              this.showMessage('Section has been updated successfully.');\n              this.addSectionModal.close();\n            },\n            (error) => this.handleErrorResponse(error)\n          );\n      } else {\n       \n        this.templateService.addSection(templateId.toString(), addSectionDTO)\n          .subscribe(\n            (newSection) => {\n              const template = this.templateList.find(t => t.id === templateId);\n              if (template) {\n                if (!template.sections) {\n                  template.sections = [];\n                }\n                template.sections.push(newSection);\n              }\n              this.showMessage('Section has been added successfully.');\n              this.addSectionModal.close();\n            },\n            (error) => this.handleErrorResponse(error)\n          );\n      }\n    }\n  }\n  \n \n  private mapSectionType(type: any): number {\n    const sectionTypeMap: { [key: string]: number } = {\n      'Form': 0,\n      'Table': 1,\n    };\n    return sectionTypeMap[type] ?? 0; \n  }\n  private handleErrorResponse(error: any) {\n    console.error('Error response:', error);\n    console.error('Error details:', JSON.stringify(error.error));\n    this.showMessage(error.error?.message || 'An unknown error occurred!', 'error');\n  }\n\n\n  showMessage(msg: string, type: 'success' | 'error' = 'success') {\n    Swal.fire({\n      icon: type,\n      title: msg,\n      toast: true,\n      position: 'top',\n      showConfirmButton: false,\n      timer: 3000,\n      customClass: { container: 'toast' },\n    });\n  }\n    deleteSection(templateId: number, sectionId: number) {\n      this.templateService.deleteSection(templateId.toString(), sectionId.toString()).subscribe(() => {\n        const template = this.templateList.find(t => t.id === templateId);\n        if (template && template.sections) {\n          template.sections = template.sections.filter(s => s.id !== sectionId);\n        }\n        this.showMessage('Section has been deleted successfully.');\n      }, error => {\n        this.showMessage(error, 'error');\n      });\n    }\n    loadSections(templateId: number) {\n      this.templateService.getTemplateById(templateId.toString()).subscribe((template) => {\n        const existingTemplate = this.templateList.find(t => t.id === templateId);\n        if (existingTemplate) {\n          existingTemplate.sections = template.sections;\n        }\n      });\n    }\n    getTemplateIdBySectionId(sectionId: number): number | undefined {\n      for (const template of this.templateList) {\n        if (template.sections) { \n          for (const section of template.sections) {\n            if (section.id === sectionId) {\n              return template.id;\n            }\n          }\n        }\n      }\n      return undefined;\n    }\n  \n\n  // Field methods\n  editField(section: Section, field: Field | null = null) {\n    this.selectedSectionId = section.id;\n    const templateId = this.getTemplateIdBySectionId(section.id);\n    this.selectedTemplateId = templateId !== undefined ? templateId : null; \n    this.addFieldModal.open();  \n    this.initFieldForm();  \n    if (field) {\n      this.fieldParams.setValue({\n        id: field.id,\n        title: field.title,\n        type: field.type,\n        isRequired: field.isRequired,\n      });\n    }\n  }\n\n  saveField() {\n   \n    \n    if (this.fieldParams.invalid) {\n      this.showMessage('Please fill all required fields.', 'error');\n      return;\n    }\n  \n    const field: Field = this.fieldParams.value;\n    const sectionId = this.selectedSectionId;\n    const templateId = this.selectedTemplateId;\n  \n  \n  \n    if (templateId != null && sectionId != null) {\n      const addFieldDTO = {\n        title: field.title,\n        type: this.mapFieldType(field.type), // Convert type correctly\n        isRequired: field.isRequired,\n      };\n  \n    \n  \n      if (field.id != null && field.id !== 0) {\n       \n       // In saveField() update case\nthis.templateService.updateField(templateId.toString(), sectionId.toString(), field.id.toString(), addFieldDTO)\n.subscribe(\n  (updatedField) => {\n    // Find and update the local field\n    const template = this.templateList.find(t => t.id === templateId);\n    const section = template?.sections?.find(s => s.id === sectionId);\n    \n    if (section?.fields) {\n      const index = section.fields.findIndex(f => f.id === updatedField.id);\n      if (index > -1) {\n        section.fields = [\n          ...section.fields.slice(0, index),\n          updatedField,\n          ...section.fields.slice(index + 1)\n        ];\n      }\n    }\n    \n    this.showMessage('Field updated successfully');\n    this.addFieldModal.close();\n  },\n  (error) => this.handleErrorResponse(error)\n);\n      } else {\n      \n     // In saveField() add case\nthis.templateService.addField(templateId.toString(), sectionId.toString(), addFieldDTO)\n.subscribe(\n  (newField) => {\n    // Find and update the local data\n    const template = this.templateList.find(t => t.id === templateId);\n    const section = template?.sections?.find(s => s.id === sectionId);\n    \n    if (section) {\n      if (!section.fields) section.fields = [];\n      section.fields = [...section.fields, newField]; // Immutable update\n    }\n    \n    this.showMessage('Field added successfully');\n    this.addFieldModal.close();\n  },\n  (error) => this.handleErrorResponse(error)\n);\n      }\n    } else {\n      this.showMessage('Template ID or Section ID is missing.', 'error');\n    }\n  }\n  \n \n  private mapFieldType(type: any): number {\n    const fieldTypeMap: { [key: string]: number } = {\n      'Text': 0,\n      'Number': 1,\n      'Date': 2,\n      'Boolean': 3,\n    };\n    return fieldTypeMap[type]; \n  }\n  deleteField(section: Section, fieldId: number) {\n    const templateId = this.getTemplateIdBySectionId(section.id); \n    \n   \n  \n    if (templateId !== undefined) {  \n      this.templateService.deleteField(templateId.toString(), section.id.toString(), fieldId.toString()).subscribe(() => {\n        const template = this.templateList.find(t => t.id === templateId);\n        const existingSection = template?.sections?.find(s => s.id === section.id);\n        if (existingSection && existingSection.fields) {\n          existingSection.fields = existingSection.fields.filter(f => f.id !== fieldId);\n        }\n        this.showMessage('Field has been deleted successfully.');\n      }, error => {\n        this.showMessage(error, 'error');\n      });\n    } else {\n      this.showMessage('Failed to delete field: Template ID is missing.', 'error');\n    }\n  }\n\n\n  loadFields(section: Section) {\n    const templateId = this.selectedTemplateId;\n    if (templateId !== null) {\n      this.templateService.getSectionFields(templateId.toString(), section.id.toString()).subscribe((fields) => {\n        section.fields = fields;\n      });\n    }\n  }\n\n  toggleSections(template: any) {\n    if (!template.sections) {\n      this.loadSections(template.id);\n    }\n    template.expanded = !template.expanded;\n  }\n  \n  toggleFields(section: any) {\n    if (!section.fields) {\n      this.loadFields(section);\n    }\n    section.expanded = !section.expanded;\n  }\n}","<div>\n    <div class=\"flex flex-wrap items-center justify-between gap-4\">\n        <h2 class=\"text-xl\">Templates</h2>\n        <div class=\"flex w-full flex-col gap-4 sm:w-auto sm:flex-row sm:items-center sm:gap-3\">\n            <div class=\"flex gap-3\">\n                <div>\n                    <button type=\"button\" class=\"btn btn-primary\" (click)=\"editTemplate()\">\n                        <icon-user-plus class=\"ltr:mr-2 rtl:ml-2\" />\n                        Add Template\n                    </button>\n                </div>\n                <div>\n                    <button\n                        type=\"button\"\n                        class=\"btn btn-outline-primary p-2\"\n                        [ngClass]=\"{ 'bg-primary text-white': displayType === 'list' }\"\n                        (click)=\"displayType = 'list'\"\n                    >\n                        <icon-list-check />\n                    </button>\n                </div>\n                <div>\n                    <button\n                        type=\"button\"\n                        class=\"btn btn-outline-primary p-2\"\n                        [ngClass]=\"{ 'bg-primary text-white': displayType === 'grid' }\"\n                        (click)=\"displayType = 'grid'\"\n                    >\n                        <icon-layout-grid />\n                    </button>\n                </div>\n            </div>\n  \n            <div class=\"relative\">\n                <input\n                    type=\"text\"\n                    placeholder=\"Search Templates\"\n                    class=\"peer form-input py-2 ltr:pr-11 rtl:pl-11\"\n                    [(ngModel)]=\"searchTemplate\"\n                    name=\"searchTemplate\"\n                    (ngModelChange)=\"searchTemplates()\"\n                />\n                <div class=\"absolute top-1/2 -translate-y-1/2 peer-focus:text-primary ltr:right-[11px] rtl:left-[11px]\">\n                    <icon-search class=\"mx-auto\" />\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Template Details (ID, Title, Unique Code) Section -->\n    <div class=\"panel mt-5 overflow-hidden border-0 p-0\">\n        <div class=\"bg-white p-6 shadow rounded-md\">\n            <div class=\"text-xl\">{{ template.title }}</div>\n            <div class=\"text-white-dark\">ID: {{ template.id }}</div>\n            <div class=\"text-white-dark\">Unique Code: {{ template.uniqeCode }}</div>\n            <button type=\"button\" class=\"btn btn-outline-secondary mt-4\" (click)=\"goBackToList()\">Back to List</button>\n        </div>\n    </div>\n\n    <!-- Template Sections and Fields Section -->\n    <div class=\"panel mt-5 overflow-hidden border-0 p-0\">\n        <ng-container *ngIf=\"displayType === 'list'\">\n            <div class=\"table-responsive\">\n                <table class=\"table-striped table-hover\">\n                    <thead>\n                        <tr>\n                            <th>Section Title</th>\n                            <th>Type</th>\n                            <th class=\"!text-center\">Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <ng-container *ngFor=\"let section of template.sections\" key=\"section.id\">\n                            <tr>\n                                <td>{{ section.title }}</td>\n                                <td>{{ section.type }}</td>\n                                <td>\n                                    <div class=\"flex items-center justify-center gap-4\">\n                                        <button type=\"button\" class=\"btn btn-sm btn-outline-primary\" (click)=\"editSection(template.id, section)\">Edit Section</button>\n                                        <button type=\"button\" class=\"btn btn-sm btn-outline-danger\" (click)=\"deleteSection(template.id, section.id)\">Delete Section</button>\n                                        <button \n                                          type=\"button\" \n                                          class=\"btn btn-sm btn-outline-secondary\" \n                                          (click)=\"toggleFields(section)\"\n                                        >\n                                          {{ section.expanded ? 'Hide Fields' : 'View Fields' }}\n                                        </button>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr *ngIf=\"section.expanded && section.fields\">\n                                <td colspan=\"3\">\n                                    <div class=\"table-responsive\">\n                                        <table class=\"table-striped table-hover\">\n                                            <thead>\n                                                <tr>\n                                                    <th>Field Title</th>\n                                                    <th>Type</th>\n                                                    <th>Required</th>\n                                                    <th class=\"!text-center\">Actions</th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>\n                                                <ng-container *ngFor=\"let field of section.fields\" key=\"field.id\">\n                                                    <tr>\n                                                        <td>{{ field.title }}</td>\n                                                        <td>{{ field.type }}</td>\n                                                        <td>{{ field.isRequired ? 'Yes' : 'No' }}</td>\n                                                        <td>\n                                                            <div class=\"flex items-center justify-center gap-4\">\n                                                                <button type=\"button\" class=\"btn btn-sm btn-outline-primary\" (click)=\"editField(section, field)\">Edit Field</button>\n                                                                <button type=\"button\" class=\"btn btn-sm btn-outline-danger\" (click)=\"deleteField(section, field.id)\">Delete Field</button>\n                                                            </div>\n                                                        </td>\n                                                    </tr>\n                                                </ng-container>\n                                                <tr>\n                                                    <td colspan=\"4\">\n                                                        <button type=\"button\" class=\"btn btn-sm btn-outline-success\" (click)=\"editField(section)\">Add Field</button>\n                                                    </td>\n                                                </tr>\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                </td>\n                            </tr>\n                        </ng-container>\n                    </tbody>\n                </table>\n            </div>\n        </ng-container>\n    </div>\n\n    <!-- Add/Edit Template Modal (unchanged) -->\n    <modal #addTemplateModal class=\"no-footer\">\n        <ng-template #modalHeader>\n            <div class=\"!font-medium\">{{ params.controls['id'].value ? 'Edit Template' : 'Add Template' }}</div>\n        </ng-template>\n        <ng-template #modalBody>\n            <form [formGroup]=\"params\" class=\"text-sm\" (ngSubmit)=\"saveTemplate()\" ngNativeValidate>\n                <div class=\"mb-5\">\n                    <label for=\"title\">Title</label>\n                    <input id=\"title\" type=\"text\" placeholder=\"Enter Title\" class=\"form-input\" formControlName=\"title\" />\n                    <div *ngIf=\"params.controls['title'].invalid && params.controls['title'].touched\" class=\"text-red-500\">\n                        <div *ngIf=\"params.controls['title'].errors?.['required']\">Title is required.</div>\n                        <div *ngIf=\"params.controls['title'].errors?.['minlength']\">Title must be at least 3 characters long.</div>\n                        <div *ngIf=\"params.controls['title'].errors?.['maxlength']\">Title cannot be more than 100 characters long.</div>\n                    </div>\n                </div>\n                <div class=\"mb-5\">\n                    <label for=\"uniqeCode\">Unique Code</label>\n                    <input id=\"uniqeCode\" type=\"text\" placeholder=\"Enter Unique Code\" class=\"form-input\" formControlName=\"uniqeCode\" />\n                    <div *ngIf=\"params.controls['uniqeCode'].invalid && params.controls['uniqeCode'].touched\" class=\"text-red-500\">\n                        <div *ngIf=\"params.controls['uniqeCode'].errors?.['required']\">Unique Code is required.</div>\n                        <div *ngIf=\"params.controls['uniqeCode'].errors?.['pattern']\">Unique Code must follow the pattern SI-XXX.</div>\n                    </div>\n                </div>\n                <div class=\"mt-8 flex items-center justify-end\">\n                    <button type=\"button\" class=\"btn btn-outline-danger\" (click)=\"addTemplateModal.close()\">Cancel</button>\n                    <button type=\"submit\" class=\"btn btn-primary ltr:ml-4 rtl:ml-4\">Save</button>\n                </div>\n            </form>\n        </ng-template>\n    </modal>\n    <!-- Add/Edit Section Modal (unchanged) -->\n    <modal #addSectionModal class=\"no-footer\">\n        <!-- Modal Content Here -->\n    </modal>\n\n    <!-- Add/Edit Field Modal (unchanged) -->\n    <modal #addFieldModal class=\"no-footer\">\n        <!-- Modal Content Here -->\n    </modal>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}